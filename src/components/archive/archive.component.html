<div class="space-y-8">
  <header class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg">
    <h1 class="text-4xl font-extrabold text-gray-800 dark:text-white">Browse Documents</h1>
    <p class="text-lg text-gray-600 dark:text-gray-300 mt-2">Search, filter, and explore all available documents.</p>
  </header>

  <!-- Filters and View Switcher -->
  <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md sticky top-[80px] z-40 flex flex-col md:flex-row gap-4 items-center">
    <!-- Search Input -->
    <div class="relative flex-grow w-full md:w-auto">
      <input
        type="text"
        placeholder="Search documents..."
        [ngModel]="searchTerm()"
        (ngModelChange)="searchTerm.set($event)"
        class="w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"
      />
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
      </div>
    </div>

    <!-- Category Filter -->
    <select [ngModel]="selectedCategory()" (ngModelChange)="selectedCategory.set($event)" class="w-full md:w-auto border rounded-lg px-4 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      <option value="All Categories">All Categories</option>
      @for(cat of categories().slice(1); track cat) { <option [value]="cat">{{ cat }}</option> }
    </select>

    <!-- Tag Filter -->
    <select [ngModel]="selectedTag()" (ngModelChange)="selectedTag.set($event)" class="w-full md:w-auto border rounded-lg px-4 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      <option value="All Tags">All Tags</option>
      @for(tag of tags().slice(1); track tag) { <option [value]="tag">{{ tag }}</option> }
    </select>

    <!-- View Switcher -->
    <div class="flex items-center bg-gray-200 dark:bg-gray-700 rounded-lg p-1">
      <button (click)="setViewMode('card')" [class]="viewMode() === 'card' ? 'bg-white dark:bg-gray-900 text-primary-600' : 'text-gray-500'" class="p-2 rounded-md transition-colors">
        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" /></svg>
      </button>
      <button (click)="setViewMode('list')" [class]="viewMode() === 'list' ? 'bg-white dark:bg-gray-900 text-primary-600' : 'text-gray-500'" class="p-2 rounded-md transition-colors">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
      </button>
      <button (click)="setViewMode('image-card')" [class]="viewMode() === 'image-card' ? 'bg-white dark:bg-gray-900 text-primary-600' : 'text-gray-500'" class="p-2 rounded-md transition-colors">
        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h14.25c.621 0 1.125.504 1.125 1.125v14.25c0 .621-.504 1.125-1.125 1.125H4.875A1.125 1.125 0 013.75 19.125V4.875zM9 12l3 3m0 0l3-3m-3 3v-6m-1.5-3.375a1.125 1.125 0 011.125-1.125h2.25a1.125 1.125 0 011.125 1.125v2.25a1.125 1.125 0 01-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625z" /></svg>
      </button>
    </div>
  </div>
  
  @if (!isLoaded()) {
    <div class="text-center py-12">
      <p class="text-gray-500">Loading documents...</p>
    </div>
  } @else {
    <div class="text-sm text-gray-500 dark:text-gray-400">
      Showing {{ filteredDocuments().length }} of {{ documents().length }} documents.
    </div>
    
    @switch (viewMode()) {
      @case ('card') {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          @for (doc of filteredDocuments(); track doc.slug) {
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden flex flex-col">
              <div class="p-6 flex-grow">
                <p class="text-sm text-primary-500 dark:text-primary-400 mb-2">{{ doc.metadata.category }}</p>
                <h3 class="text-xl font-bold mb-2 h-16">
                  <a [routerLink]="['/doc', doc.slug]" class="text-gray-800 dark:text-white hover:text-primary-600 dark:hover:text-primary-300 transition-colors">{{ doc.metadata.title }}</a>
                </h3>
                <p class="text-gray-600 dark:text-gray-300 mb-4 h-24 overflow-hidden text-ellipsis">{{ doc.metadata.description }}</p>
              </div>
              <div class="bg-gray-50 dark:bg-gray-700/50 px-6 py-4 mt-auto">
                <a [routerLink]="['/doc', doc.slug]" class="font-semibold text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-200">Read More &rarr;</a>
              </div>
            </div>
          }
        </div>
      }
      @case ('list') {
        <div class="space-y-4">
          @for (doc of filteredDocuments(); track doc.slug) {
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 p-4 flex flex-col sm:flex-row justify-between items-start">
              <div class="flex-grow">
                <p class="text-sm text-gray-500 mb-1">{{ doc.metadata.date | date:'longDate' }}</p>
                <h2 class="text-xl font-bold">
                  <a [routerLink]="['/doc', doc.slug]" class="text-gray-800 dark:text-white hover:text-primary-600 transition-colors">{{ doc.metadata.title }}</a>
                </h2>
                <p class="text-gray-600 dark:text-gray-400 mt-1">{{ doc.metadata.description }}</p>
              </div>
              <div class="mt-4 sm:mt-0 sm:ml-6 flex-shrink-0">
                <a [routerLink]="['/doc', doc.slug]" class="font-semibold text-primary-600 hover:text-primary-800">View Document &rarr;</a>
              </div>
            </div>
          }
        </div>
      }
      @case ('image-card') {
         <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          @for (doc of filteredDocuments(); track doc.slug; let i = $index) {
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden flex flex-col group">
              <div class="relative h-48 bg-gray-200 dark:bg-gray-700 overflow-hidden">
                <img [src]="'https://picsum.photos/400/200?random=' + i" alt="Document preview" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                <div class="absolute inset-0 bg-black/20"></div>
              </div>
              <div class="p-6 flex-grow">
                <p class="text-sm text-primary-500 dark:text-primary-400 mb-2">{{ doc.metadata.category }}</p>
                <h3 class="text-xl font-bold mb-2">
                  <a [routerLink]="['/doc', doc.slug]" class="text-gray-800 dark:text-white hover:text-primary-600 dark:hover:text-primary-300 transition-colors">{{ doc.metadata.title }}</a>
                </h3>
              </div>
            </div>
          }
        </div>
      }
    }
    
    @if (filteredDocuments().length === 0) {
      <div class="text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-lg">
        <h3 class="text-xl font-semibold text-gray-700 dark:text-white">No Documents Found</h3>
        <p class="text-gray-500 dark:text-gray-400 mt-2">Try adjusting your search or filter criteria.</p>
      </div>
    }
  }
</div>
